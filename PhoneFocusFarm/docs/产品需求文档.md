# 手机专注农场应用 - 产品需求文档

## 1. 产品概述

### 1.1 产品定位
手机专注农场是一款帮助用户减少手机使用、培养专注习惯的Android应用。通过游戏化的农场养成机制，将用户的专注时间转化为虚拟农场中的动物孵化与成长，提供正向激励。

### 1.2 核心价值
- **习惯养成**：通过孵化奖励机制强化用户的专注习惯
- **游戏化体验**：3D农场场景和动物互动提供趣味性
- **社交分享**：支持微信分享战绩，增加用户粘性
- **数据统计**：详细的专注数据统计和成就系统

## 2. 功能需求

### 2.1 核心功能

#### 2.1.1 专注计时系统
- **孵化机制**：
  - 15分钟无操作 → 孵化出一只鸡
  - 30分钟无操作 → 已存在的鸡升级变身为猫
  - 60分钟无操作 → 已存在的猫升级变身为狗
- **中断判定**：检测到触摸事件、离开App或设备显著活动则重置计时
- **测试模式**：为方便测试，阈值缩减为10/20/30秒

#### 2.1.2 专注模式
- **严格模式（默认）**：
  - App需前台运行
  - 无触摸事件且设备静置（低加速度/陀螺仪阈值）
  - 检测到触摸、离开App或显著活动即中断
- **自然模式**：
  - App需前台运行
  - 离开App或显著活动视为中断

#### 2.1.3 3D农场系统
- **动物行为**：
  - 随机游走（噪声方向、速度限制）
  - 追逐关系：狗→猫→鸡
  - 限制同时追逐数量和加速度上限
- **互动功能**：
  - 点击动物触发躲避动画
  - 播放对应音效（SoundPool）
  - 支持圆/矩形碰撞检测

#### 2.1.4 数据统计
- **周期统计**：支持一周等自定义周期
- **统计指标**：生成数量、最长孵化时长等
- **成就系统**：奖章发放与展示
- **历史记录**：详细的专注历史数据

#### 2.1.5 社交分享
- **战绩海报**：使用Compose/Canvas渲染为Bitmap
- **微信分享**：集成微信SDK，支持图片分享到聊天
- **分享模板**：可配置的文案模板

### 2.2 系统功能

#### 2.2.1 权限管理
- **必需权限**：
  - `PACKAGE_USAGE_STATS`（使用情况访问）
  - `FOREGROUND_SERVICE`（前台服务）
  - `WAKE_LOCK`（唤醒锁定）
  - `POST_NOTIFICATIONS`（Android 13+通知）
- **可选权限**：
  - `BODY_SENSORS`（部分机型需要）
  - `SYSTEM_ALERT_WINDOW`（不强制）

#### 2.2.2 系统设置引导
- **电池优化白名单**：`ACTION_REQUEST_IGNORE_BATTERY_OPTIMIZATIONS`
- **自启动设置**：EMUI设置路径指引
- **权限引导**：清晰的权限说明和开启指引

## 3. 用户体验需求

### 3.1 界面设计
- **简洁生动**：现代化设计风格，色彩明快
- **3D渲染**：农场场景采用3D游戏渲染技术
- **流畅动画**：60fps目标帧率，支持45-60fps自适应
- **响应式**：适配不同屏幕尺寸

### 3.2 交互设计
- **直观操作**：简单易懂的操作流程
- **即时反馈**：用户操作有明确的视觉和音效反馈
- **状态提示**：清晰的专注状态和中断提示

## 4. 性能需求

### 4.1 性能指标
- **帧率**：≥55fps（Mate40 Pro/Mate30）
- **实体数量**：上限约50个动物
- **内存占用**：优化资源加载，控制内存使用
- **电量消耗**：深色主题、低亮度引导

### 4.2 兼容性
- **目标系统**：Android 10/11+（EMUI 11/12）
- **设备适配**：重点适配Mate40 Pro/Mate30
- **分辨率适配**：支持主流Android设备分辨率

## 5. 数据需求

### 5.1 数据模型
- **Animal**：id、type、pos、vel、state
- **IncubationSession**：startTs、endTs、result、mode、interruptionReason
- **Cycle**：cycleId、start、end、sessions、stats
- **Achievement/Badge**：统计指标与达成条件

### 5.2 数据持久化
- **Room数据库**：animals、sessions、cycles、achievements、badges表
- **DataStore**：存放轻量设置
- **数据安全**：本地数据加密存储

## 6. 测试需求

### 6.1 功能测试
- **计时精度**：严格模式锁屏计时误差≤2秒
- **误报率**：自然模式误报率≤2%
- **稳定性**：长时连续计时稳定
- **分享成功率**：微信分享成功率≥99%

### 6.2 性能测试
- **帧率测试**：大部分时段稳定≥55fps
- **内存测试**：长时间运行内存泄漏检测
- **电量测试**：发热和电量消耗监控

## 7. 风险与应对

### 7.1 技术风险
- **权限被拒**：降级到严格模式，明确引导开权限
- **后台限制**：必须启用前台服务，引导白名单设置
- **传感器噪声**：低通滤波和阈值自适应

### 7.2 用户体验风险
- **中断误判**：优化判定算法，降低误报率
- **性能问题**：资源优化，降帧和动画简化策略
- **设备兼容性**：充分测试，及时修复适配问题

## 8. 验收标准

### 8.1 功能验收
- ✅ 专注计时功能正常，孵化机制准确
- ✅ 3D农场渲染流畅，动物互动响应及时
- ✅ 数据统计准确，奖章发放正确
- ✅ 微信分享功能稳定可靠

### 8.2 性能验收
- ✅ 帧率≥55fps，大部分时段稳定
- ✅ 内存占用合理，无内存泄漏
- ✅ 电量消耗可控，发热正常

### 8.3 质量验收
- ✅ 代码质量达标，架构清晰
- ✅ 测试覆盖率充足，Bug率低于行业标准
- ✅ 文档完整，交付资料齐全